<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title></title>

    <style>
      body {
        margin: 0;
        min-height: 100vh;
        overflow-y: hidden;
      }

      canvas {
        width: 100vw;
        height: 100vh;
      }
    </style>
  </head>
  <body>
    <div>
      <canvas></canvas>
    </div>

    <script>
      const canvas = document.querySelector("canvas")
      const ctx = canvas.getContext("2d")

      const {innerWidth, innerHeight} = window

      const [sw, sh] = [innerWidth * 2, innerHeight * 2]

      canvas.width = sw
      canvas.height = sh

      let size = 100

      const keystate = {
        ArrowUp: false,
        ArrowDown: false,
        ArrowLeft: false,
        ArrowRight: false
      }

      const state = {
        x: 100,
        y: 100,
        playerColor: '#fed330'
      }

      function square(x, y, size, color) {
        ctx.fillStyle = color
        ctx.fillRect(x, y, size, size)
      }

      function SquareCollider(cx, cy, size, color, toColor, cb) {
        const {x, y} = state

        const isColliding = x > cx && x < cx + size && y > cy && y < cy + size

        square(cx, cy, size, isColliding ? toColor : color)

        if (isColliding && cb) cb()
      }

      function gameLoop() {
        ctx.fillStyle = "#111"
        ctx.fillRect(0, 0, sw, sh)

        Object.entries(keystate).map(([key, state], i) => {
          const debugSize = 10

          // Debug Squares
          ctx.fillStyle = state ? '#26de81' : "#eb3b5a"
          ctx.fillRect((i * debugSize), 0, debugSize, debugSize)

          if (state) {
            const handle = keymap[key]
            if (handle) handle()
          }
        })
        
        SquareCollider(500, 800, 300, "#fc5c65", "#ff8c6f", () => state.playerColor = '#ff8c6f')

        square(state.x, state.y, size, state.playerColor)

        requestAnimationFrame(gameLoop)
      }

      let moveBy = 10

      const keymap = {
        ArrowUp: () => state.y > 0 && (state.y -= moveBy),
        ArrowDown: () => state.y < (sh - moveBy - 50) && (state.y += moveBy),
        ArrowLeft: () => state.x > 0 && (state.x -= moveBy),
        ArrowRight: () => state.x < (sw - moveBy) && (state.x += moveBy)
      }

      document.addEventListener("keydown", (e) => {
        keystate[e.key] = true
      })

      document.addEventListener("keyup", (e) => {
        keystate[e.key] = false
      })

      gameLoop()
    </script>
  </body>
</html>
